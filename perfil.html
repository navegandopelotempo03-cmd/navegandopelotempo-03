<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Perfil - Museu Digital</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;1,300;1,400&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="./css/login.css">
    <style>
        /* Garantir que o scroll funcione sem barra vis√≠vel */
        html {
            overflow-y: auto !important;
            height: auto !important;
            min-height: 100vh;
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE/Edge */
        }

        html::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }

        body {
            overflow-y: auto !important;
            height: auto !important;
            min-height: 100vh;
            position: relative !important;
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE/Edge */
        }

        body::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }

        .perfil-container {
            max-width: 1200px;
            margin: 8rem auto 4rem;
            padding: 0 2rem;
            position: relative;
            z-index: 1;
        }

        .perfil-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 3rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.16);
            border-left: 6px solid var(--accent);
        }

        body.dark-mode .perfil-header {
            background: rgba(26, 26, 26, 0.95);
            border-left-color: var(--accent-hover);
        }

        .perfil-header h1 {
            font-family: 'Playfair Display', serif;
            color: var(--accent);
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .perfil-info {
            color: var(--text-body);
            opacity: 0.8;
            font-size: 1.1rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
            border: 2px solid var(--accent);
        }

        body.dark-mode .stat-card {
            background: rgba(26, 26, 26, 0.95);
        }

        .stat-valor {
            font-size: 3rem;
            font-weight: 900;
            color: var(--accent);
            display: block;
            line-height: 1;
        }

        .stat-label {
            font-size: 1rem;
            color: var(--text-body);
            margin-top: 0.5rem;
            opacity: 0.8;
        }

        .progresso-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 3rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.16);
        }

        body.dark-mode .progresso-section {
            background: rgba(26, 26, 26, 0.95);
        }

        .progresso-section h2 {
            font-family: 'Playfair Display', serif;
            color: var(--accent);
            font-size: 2rem;
            margin-bottom: 1.5rem;
        }

        .quiz-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            margin-bottom: 0.5rem;
            background: rgba(251, 118, 33, 0.1);
            border-radius: 10px;
            border-left: 4px solid var(--accent);
        }

        body.dark-mode .quiz-item {
            background: rgba(251, 118, 33, 0.15);
        }

        .quiz-nome {
            font-weight: 600;
            color: var(--text-body);
        }

        .quiz-pontuacao {
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--accent);
        }

        .btn-logout {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 30px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
            transition: all 0.3s ease;
            margin-top: 2rem;
        }

        .btn-logout:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.16);
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-body);
            opacity: 0.6;
            font-style: italic;
        }
    </style>
</head>
<body>

    <!-- Bot√£o de Acessibilidade -->
  <button class="accessibility-button" onclick="toggleAccessibilityMenu()" aria-label="Menu de Acessibilidade">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="10"></circle>
      <circle cx="12" cy="8" r="1.5"></circle>
      <path d="M12 10v4"></path>
      <path d="M8 16h8"></path>
      <path d="M8 12h8"></path>
    </svg>
  </button>

  <!-- Menu de Acessibilidade -->
  <div class="accessibility-menu" id="accessibilityMenu">
    <h3>‚ôø Acessibilidade</h3>
    
    <div class="accessibility-section">
      <h4>Tamanho da Fonte</h4>
      <div class="font-size-controls">
        <button onclick="changeFontSize('small')">üî§ Pequeno</button>
        <button onclick="changeFontSize('medium')" class="active">üî§ M√©dio</button>
        <button onclick="changeFontSize('large')">üî§ Grande</button>
      </div>
    </div>

    <div class="accessibility-section">
      <h4>Contraste</h4>
      <button class="accessibility-action" onclick="toggleHighContrast()">
        <span class="icon">‚ö´‚ö™</span>
        Alto Contraste
      </button>
    </div>

    <div class="accessibility-section">
      <h4>Leitor de Tela</h4>
      <button class="accessibility-action" onclick="toggleScreenReader()">
        <span class="icon">üîä</span>
        <span id="screenReaderText">Ativar Leitor</span>
      </button>
      <div class="screen-reader-controls" id="readerControls" style="display: none;">
        <button onclick="pauseReading()" id="pauseBtn">‚è∏Ô∏è</button>
        <button onclick="resumeReading()" id="resumeBtn">‚ñ∂Ô∏è</button>
        <button onclick="stopReading()">‚èπÔ∏è</button>
      </div>
    </div>

    <div class="accessibility-section">
      <h4>Libras</h4>
      <button class="accessibility-action" onclick="toggleVLibras()">
        <span class="icon">ü§ü</span>
        Ativar VLibras
      </button>
    </div>
  </div>

  <!-- VLibras (escondido por padr√£o) -->
  <div vw class="enabled" id="vlibras-widget" style="display: none;">
    <div vw-access-button class="active"></div>
    <div vw-plugin-wrapper>
      <div class="vw-plugin-top-wrapper"></div>
    </div>
  </div>
  <script src="https://vlibras.gov.br/app/vlibras-plugin.js"></script>
  <script>
    new window.VLibras.Widget('https://vlibras.gov.br/app');
  </script>


<script>
    function toggleMode() {
      document.body.classList.toggle("dark-mode");
      const btn = document.querySelector(".btn-toggle");
      const icon = btn?.querySelector(".icon");
      const text = btn?.querySelector(".text");
      
      if (document.body.classList.contains("dark-mode")) {
        if (icon) icon.textContent = "‚òÄÔ∏è";
        if (text) text.textContent = "Modo Claro";
      } else {
        if (icon) icon.textContent = "üåô";
        if (text) text.textContent = "Modo Escuro";
      }
    }

    // Menu de Acessibilidade
    function toggleAccessibilityMenu() {
      const menu = document.getElementById('accessibilityMenu');
      menu.classList.toggle('active');
      if (menu.classList.contains('active')) {
        menu.style.display = 'block';
      } else {
        menu.style.display = 'none';
      }
    }

    // Controle de tamanho de fonte
    function changeFontSize(size) {
      const body = document.body;
      body.classList.remove('font-small', 'font-medium', 'font-large');
      body.classList.add('font-' + size);
      
      // Atualizar bot√£o ativo
      document.querySelectorAll('.font-size-controls button').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
    }

    // Alto contraste
    let highContrastEnabled = false;
    function toggleHighContrast() {
      highContrastEnabled = !highContrastEnabled;
      document.body.classList.toggle('high-contrast', highContrastEnabled);
      
      const btn = event.target.closest('button');
      btn.style.background = highContrastEnabled ? 
        'rgba(255, 255, 255, 0.3)' : 
        'rgba(255, 255, 255, 0.1)';
    }

    // ========== LEITOR DE TELA ==========
    let screenReaderEnabled = false;
    let currentUtterance = null;
    let isPaused = false;

    function toggleScreenReader() {
      screenReaderEnabled = !screenReaderEnabled;
      const btn = event.target.closest('button');
      const text = document.getElementById('screenReaderText');
      const controls = document.getElementById('readerControls');
      
      if (screenReaderEnabled) {
        text.textContent = 'Desativar Leitor';
        btn.style.background = 'rgba(255, 255, 255, 0.3)';
        controls.style.display = 'flex';
        startReading();
      } else {
        text.textContent = 'Ativar Leitor';
        btn.style.background = 'rgba(255, 255, 255, 0.1)';
        controls.style.display = 'none';
        stopReading();
      }
    }

    function startReading() {
      if ('speechSynthesis' in window) {
        // Pegar todo o conte√∫do principal
        const mainContent = document.querySelector('main');
        const header = document.querySelector('header');
        
        let textToRead = '';
        
        // Adicionar t√≠tulo
        if (header) {
          const h1 = header.querySelector('h1');
          const h2 = header.querySelector('h2');
          if (h1) textToRead += h1.textContent + '. ';
          if (h2) textToRead += h2.textContent + '. ';
        }
        
        // Adicionar conte√∫do principal
        if (mainContent) {
          const paragraphs = mainContent.querySelectorAll('p');
          paragraphs.forEach(p => {
            if (p.textContent.trim()) {
              textToRead += p.textContent + '. ';
            }
          });
        }
        
        // Criar utterance
        currentUtterance = new SpeechSynthesisUtterance(textToRead);
        currentUtterance.lang = 'pt-BR';
        currentUtterance.rate = 0.9; // Velocidade
        currentUtterance.pitch = 1; // Tom
        currentUtterance.volume = 1; // Volume
        
        // Destacar texto sendo lido
        let currentIndex = 0;
        const words = textToRead.split(' ');
        
        currentUtterance.onboundary = function(event) {
          if (event.name === 'word') {
            highlightCurrentWord(currentIndex, words);
            currentIndex++;
          }
        };
        
        currentUtterance.onend = function() {
          removeHighlight();
          if (screenReaderEnabled) {
            document.getElementById('screenReaderText').textContent = 'Leitura Conclu√≠da';
          }
        };
        
        // Iniciar leitura
        window.speechSynthesis.speak(currentUtterance);
        
      } else {
        alert('Desculpe, seu navegador n√£o suporta s√≠ntese de voz.');
      }
    }

    function pauseReading() {
      if (window.speechSynthesis.speaking && !isPaused) {
        window.speechSynthesis.pause();
        isPaused = true;
        document.getElementById('pauseBtn').textContent = '‚è∏Ô∏è';
      }
    }

    function resumeReading() {
      if (isPaused) {
        window.speechSynthesis.resume();
        isPaused = false;
        document.getElementById('pauseBtn').textContent = '‚è∏Ô∏è';
      }
    }

    function stopReading() {
      window.speechSynthesis.cancel();
      removeHighlight();
      isPaused = false;
    }

    function highlightCurrentWord(index, words) {
      removeHighlight();
      const paragraphs = document.querySelectorAll('main p, header h1, header h2');
      
      paragraphs.forEach(p => {
        if (p.textContent.includes(words[index])) {
          p.classList.add('reading-highlight');
        }
      });
    }

    function removeHighlight() {
      document.querySelectorAll('.reading-highlight').forEach(el => {
        el.classList.remove('reading-highlight');
      });
    }

    // VLibras
    let vlibrasEnabled = false;
    function toggleVLibras() {
      vlibrasEnabled = !vlibrasEnabled;
      const widget = document.getElementById('vlibras-widget');
      widget.style.display = vlibrasEnabled ? 'block' : 'none';
      
      const btn = event.target.closest('button');
      btn.style.background = vlibrasEnabled ? 
        'rgba(255, 255, 255, 0.3)' : 
        'rgba(255, 255, 255, 0.1)';
    }

    // Fechar menu ao clicar fora
    document.addEventListener('click', function(event) {
      const menu = document.getElementById('accessibilityMenu');
      const button = document.querySelector('.accessibility-button');
      
      if (!menu.contains(event.target) && !button.contains(event.target)) {
        menu.classList.remove('active');
        menu.style.display = 'none';
      }
    });

    // Limpar leitura ao sair da p√°gina
    window.addEventListener('beforeunload', function() {
      if (currentUtterance) {
        window.speechSynthesis.cancel();
      }
    });
  </script>

    <img src="./img/logo.png" alt="Logo do Museu" class="logo">

    <button class="btn-toggle" onclick="toggleMode()">
        <span id="modeIcon">üåô</span>
        <span id="modeText">Modo Escuro</span>
    </button>
    
 <button class="btn-voltar" onclick="window.history.back()">
    <span>‚Üê Voltar</span>
  </button>

    <div class="perfil-container">
        <!-- Header do Perfil -->
        <div class="perfil-header">
            <h1>üë§ <span id="nome-usuario">Carregando...</span></h1>
            <p class="perfil-info">
                <strong>Email:</strong> <span id="email-usuario">-</span><br>
                <strong>Membro desde:</strong> <span id="data-cadastro">-</span>
            </p>
        </div>

        <!-- Estat√≠sticas -->
        <div class="stats-grid">
            <div class="stat-card">
                <span class="stat-valor" id="stat-progresso">0%</span>
                <span class="stat-label">Progresso Total</span>
            </div>
            <div class="stat-card">
                <span class="stat-valor" id="stat-marcos">0/16</span>
                <span class="stat-label">Marcos Lidos</span>
            </div>
            <div class="stat-card">
                <span class="stat-valor" id="stat-quizzes">0/16</span>
                <span class="stat-label">Quizzes Feitos</span>
            </div>
            <div class="stat-card">
                <span class="stat-valor" id="stat-media">0</span>
                <span class="stat-label">M√©dia Quizzes</span>
            </div>
        </div>

        <!-- Quizzes Completados -->
        <div class="progresso-section">
            <h2>üéØ Pontua√ß√µes dos Quizzes</h2>
            <div id="quizzes-lista">
                <!-- Preenchido via JavaScript -->
            </div>
        </div>

        <!-- Bot√£o Logout -->
        <div style="text-align: center;">
            <button class="btn-logout" onclick="AUTH.logout()">üö™ Sair da Conta</button>
        </div>
    </div>

    <script src="./js/auth.js"></script>
    <script src="./js/login.js"></script>
    <script>
        // Verificar se est√° logado
        if (!AUTH.estaLogado()) {
            window.location.href = 'login.html';
        }

        // Carregar dados do perfil
        function carregarPerfil() {
            const usuario = AUTH.getUsuarioAtual();
            const stats = AUTH.getEstatisticas();

            // Informa√ß√µes do usu√°rio
            document.getElementById('nome-usuario').textContent = usuario.nome;
            document.getElementById('email-usuario').textContent = usuario.email;
            
            const dataCadastro = new Date(usuario.criadoEm).toLocaleDateString('pt-BR');
            document.getElementById('data-cadastro').textContent = dataCadastro;

            // Estat√≠sticas
            document.getElementById('stat-progresso').textContent = stats.progressoTotal + '%';
            document.getElementById('stat-marcos').textContent = `${stats.marcosLidos}/${stats.totalMarcos}`;
            document.getElementById('stat-quizzes').textContent = `${stats.quizzesFeitos}/${stats.totalMarcos}`;
            document.getElementById('stat-media').textContent = stats.mediaQuizzes;

            // Quizzes
            const quizzesLista = document.getElementById('quizzes-lista');
            const quizzes = stats.detalhesQuizzes;
            
            if (Object.keys(quizzes).length === 0) {
                quizzesLista.innerHTML = '<div class="empty-state">Nenhum quiz realizado ainda. Comece a explorar os marcos!</div>';
            } else {
                quizzesLista.innerHTML = '';
                Object.entries(quizzes).forEach(([marco, dados]) => {
                    const div = document.createElement('div');
                    div.className = 'quiz-item';
                    div.innerHTML = `
                        <div>
                            <span class="quiz-nome">${marco}</span>
                            <small style="display: block; opacity: 0.7;">
                                ${new Date(dados.data).toLocaleDateString('pt-BR')} ‚Ä¢ 
                                ${dados.tentativas} tentativa${dados.tentativas > 1 ? 's' : ''}
                            </small>
                        </div>
                        <span class="quiz-pontuacao">${dados.pontuacao}/100</span>
                    `;
                    quizzesLista.appendChild(div);
                });
            }
        }

        // Carregar perfil ao iniciar
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', carregarPerfil);
        } else {
            carregarPerfil();
        }
    </script>
</body>
</html>